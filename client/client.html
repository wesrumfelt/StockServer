<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
var socket = null
function subscribe(channel) {
    var subscribeUrl = 'ws://localhost:9000/ws'
    console.log("Subscribed to: " + subscribeUrl)
    socket = new WebSocket(subscribeUrl)
    socket.onmessage = function(event) {
        $("#messages" ).prepend("<div>" + event.data + "</div>")
    }
    socket.onclose = function(event) {
        console.log(event)
    }
}
$(document).ready(function(){
    subscribe($("#channel" ).val())
    $("#channel" ).change(function(){
        if(socket) socket.close()
        subscribe($(this ).val())
    })
    $("button").click(function(){
        var publishUrl = 'ws://localhost:9000/ws';
        jQuery.post(publishUrl, "message="+$("#message" ).val() ).success(function(){
            $("#message" ).val("")
        })
    })
});
</script>
</head>
<body>

<h2>This is a heading</h2>

<p>This is a paragraph.</p>
<p>This is another paragraph.</p>
<div id="message"></div>
<button>Click me to hide paragraphs</button>

</body>
</html>
